<!DOCTYPE html>
<html lang="en">

    <div th:replace="fragments/header-uri :: head(title='Data Question')"></div>

    <body class="animsition">
        <div class="page-wrapper">
            <div th:replace="fragments/header-uri :: header_mobile"></div>
            <!-- PAGE CONTAINER-->
            <div class="page-container">
                <div th:replace="fragments/header-uri :: header_desktop"></div>
                <!-- MAIN CONTENT-->
                <div class="main-content">
                    <div class="section__content section__content--p30">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="overview-wrap">
                                        <h2 class="title-1">Category <span th:text="${selectModule}"></span></h2>
                                        <button type="button" class="au-btn au-btn-icon au-btn--green" data-toggle="modal" data-target="#questionModal" onclick="insert();">
                                            <i class="zmdi zmdi-plus"></i>Add</button>
                                    </div>
                                </div>
                            </div>
                            <div class="m-t-25">
                                <table id="table" class="table table-striped table-hover table-bordered" style="width:100%">
                                    <thead class="thead-dark">
                                        <tr>    
                                            <th >Id</th>
                                            <th>Question</th>
                                            <th>a</th>
                                            <th>b</th>
                                            <th>c</th>
                                            <th>d</th>
                                            <th>Answer</th>
                                            <th>Action</th>    
                                        </tr>
                                    </thead>
                                    <tbody>
                                    <tbody>
                                        <tr th:each="questionss : ${questions}">
                                            <td th:text = "${questionss.id}"></td> 
                                            <td th:text = "${questionss.question}"></td> 
                                            <td th:text = "${questionss.a}"></td> 
                                            <td th:text = "${questionss.b}"></td> 
                                            <td th:text = "${questionss.c}"></td> 
                                            <td th:text = "${questionss.d}"></td> 
                                            <td th:text = "${questionss.answer}"></td> 
                                            <td>
                                                <button th:id= "${questionss.id}" class="btn btn-warning" type="button" data-toggle="modal" data-target ="#questionModal" onclick="update(this.id);">
                                                    Update
                                                </button>
                                                <!--<a th:href="@{../getIdQuestion/{id} (id=${as.id})}" class="btn btn-sm btn-success">Update<span class="fas fa-envelope"></span></a>-->
                                            </td> 

                                        </tr> 
                                    </tbody>
                                </table>
                            </div>
                            <div th:replace="fragments/footer-uri :: footer"></div>

                        </div>
                    </div>
                </div>
                <!-- END MAIN CONTENT-->
                <!-- END PAGE CONTAINER-->
            </div>

        </div>
        <div th:insert="component/modal :: modal"></div>
        <div th:replace="fragments/footer-uri :: script"></div>
        <script type="text/javascript">
            $(document).ready(function () {
                $('#table').DataTable();
            });
            
            var save_method;

            function insert() {
                save_method = 'add';
                document.getElementById('labelId').hidden = true;
                document.getElementById('textId').hidden = true;
            }

            function update(getId) {
                save_method = 'update';
                document.getElementById('labelId').hidden = false;
                document.getElementById('textId').hidden = false;
                document.getElementById('textId').readOnly = "true";

                $.ajax({
                    url: "getById",
                    type: "GET",
                    dataType: "json",
                    data: {id: getId},
                    success: function (result) {
                        $("#textId").val(result.id);
                        $("#textQuestion").val(result.question);
                        $("#textA").val(result.a);
                        $("#textB").val(result.b);
                        $("#textC").val(result.c);
                        $("#textD").val(result.d);
                        $("#textAnswer").val(result.answer);
                        $("#textActive").val(result.isActive);
                        $("#textModule").val(result.module);
                    },
                    error: function (errormessage) {
                        alert(errormessage.responseText);
                    }
                });
            }

            function saveQuestion() {
                var question = new Object();
                question.id = document.getElementById("textId").value;
                question.question = document.getElementById("textQuestion").value;
                question.a = document.getElementById("textA").value;
                question.b = document.getElementById("textB").value;
                question.c = document.getElementById("textC").value;
                question.d = document.getElementById("textD").value;
                question.answer = document.getElementById("textAnswer").value;
                question.isActive = 1;
                question.module = document.getElementById("textModule").value;
                var Simpan;

                if (save_method == 'add') {
                    Simpan = 'Added';
                } else {
                    Simpan = 'Updated';
                }

                $.ajax({

                    url: "/save",
                    type: "POST",
                    data: JSON.stringify(question),
                    contentType: "application/json; charset=utf-8",
                    success: function () {
//                        $('#table').DataTable().ajax.reload();
                        Swal.fire({
                            icon: 'success',
                            title: 'Data successfull ' + Simpan,
                            showConfirmButton: false,
                            timer: 1500
                        })
                        document.getElementById('insertForm').reset();
                    },
                    error: function (errormessage) {
                        alert(errormessage.responseText);
                    }
                });
            }

            function hapus(getId) {
                var questionTable = $('#table').DataTable
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    $.ajax({
                        url: "deleteById",
                        type: "GET",
                        data: {id: getId},
                        success: function () {
                            $('#table').DataTable().ajax.reload();
                            Swal.fire({
                                icon: 'success',
                                title: 'Data successfull deleted',
                                showConfirmButton: false,
                                timer: 1500
                            })
                        },
                        error: function (errormessage) {
                            alert(errormessage.responseText);
                        }
                    });
                })

            }
        </script>
    </body>

</html>
<!-- end document-->
